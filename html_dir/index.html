<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-top: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .status-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .status-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .status-message {
            font-size: 1.1rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .main-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 40px 0;
        }

        .main-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 20px;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: flex-start;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .main-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .main-btn.lecture {
            background: rgba(52, 152, 219, 0.3);
            border-color: rgba(52, 152, 219, 0.4);
        }

        .main-btn.seminar {
            background: rgba(46, 204, 113, 0.3);
            border-color: rgba(46, 204, 113, 0.4);
        }

        .main-btn.rating {
            background: rgba(155, 89, 182, 0.3);
            border-color: rgba(155, 89, 182, 0.4);
        }

        .main-btn.admin {
            background: rgba(241, 196, 15, 0.3);
            border-color: rgba(241, 196, 15, 0.4);
        }

        .main-btn-icon {
            font-size: 2rem;
            min-width: 40px;
        }

        .btn-text {
            flex-grow: 1;
            text-align: left;
        }

        .btn-status {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            opacity: 0.8;
        }

        .rating-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            display: none;
        }

        .rating-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .rating-table th {
            text-align: left;
            padding: 12px 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .rating-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .rating-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .medal {
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .user-position {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 1.1rem;
        }

        .user-position strong {
            color: #4CAF50;
        }

        /* –ê–¥–º–∏–Ω-—Å–µ–∫—Ü–∏—è (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        .admin-section {
            background: rgba(241, 196, 15, 0.05);
            border: 2px solid rgba(241, 196, 15, 0.2);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            display: none;
        }

        .admin-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .admin-btn {
            background: rgba(241, 196, 15, 0.1);
            border: 1px solid rgba(241, 196, 15, 0.3);
            padding: 12px;
            border-radius: 8px;
            color: #f1c40f;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-btn:hover {
            background: rgba(241, 196, 15, 0.2);
            transform: translateY(-2px);
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .main-buttons {
                grid-template-columns: 1fr;
            }

            .rating-table {
                font-size: 0.9rem;
            }

            .admin-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üéì</div>
            <h1>–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</h1>
            <p class="subtitle">–õ–µ–∫—Ü–∏–∏, —Å–µ–º–∏–Ω–∞—Ä—ã, —Ä–µ–π—Ç–∏–Ω–≥ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
        </header>

        <div class="status-card">
            <div class="status-icon">üöß</div>
            <div class="status-title">–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
            <div class="status-message">
                –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.<br>
                –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.<br>
                <br>
                <strong>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å API:</strong>
                <div id="api-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="main-buttons">
            <button class="main-btn lecture" onclick="openLectures()">
                <span class="main-btn-icon">üìö</span>
                <span class="btn-text">–õ–µ–∫—Ü–∏–∏</span>
                <span class="btn-status">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span>
            </button>

            <button class="main-btn seminar" onclick="openSeminars()">
                <span class="main-btn-icon">üéØ</span>
                <span class="btn-text">–°–µ–º–∏–Ω–∞—Ä—ã</span>
                <span class="btn-status">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span>
            </button>
            <button class="main-btn rating" onclick="toggleRating()">
                <span class="main-btn-icon">üìä</span>
                <span class="btn-text">–†–µ–π—Ç–∏–Ω–≥</span>
                <span class="btn-status">–î–æ—Å—Ç—É–ø–Ω–æ</span>
            </button>

            <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç–∞/–ø–æ–∫–∞–∑–∞–Ω–∞ —á–µ—Ä–µ–∑ JS) -->
            <button class="main-btn admin" id="admin-panel-btn" style="display: none;" onclick="openAdminPanel()">
                <span class="main-btn-icon">üëë</span>
                <span class="btn-text">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
                <span class="btn-status">–¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤</span>
            </button>
        </div>

        <!-- –ê–¥–º–∏–Ω-—Å–µ–∫—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
        <div class="admin-section" id="admin-section">
            <h2>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π (–¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º)</p>

            <div class="admin-buttons">
                <button class="admin-btn" onclick="openAdminUsers()">
                    üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </button>
                <button class="admin-btn" onclick="openAdminGroups()">
                    üè´ –ì—Ä—É–ø–ø—ã
                </button>
                <button class="admin-btn" onclick="openAdminRating()">
                    üìä –†–µ–π—Ç–∏–Ω–≥
                </button>
                <button class="admin-btn" onclick="window.location.href='/admin/lectures.html?user_id=' + currentUserId + '&admin=true'">
                üìö –î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫—Ü–∏—é
                </button>
                <button class="admin-btn" onclick="openAdminLogs()">
                    üìã –õ–æ–≥–∏
                </button>
                <button class="admin-btn" onclick="openAdminStats()">
                    üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </button>
                <button class="admin-btn" onclick="openAdminSettings()">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
                <button class="admin-btn" onclick="recalculateAllRatings()">
                    üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
                </button>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="rating-section" id="rating-section">
            <h2>üèÜ –¢–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥</h2>
            <table class="rating-table">
                <thead>
                    <tr>
                        <th>–ú–µ—Å—Ç–æ</th>
                        <th>–ò–º—è</th>
                        <th>–ë–∞–ª–ª—ã</th>
                        <th>–ì—Ä—É–ø–ø–∞</th>
                        <th>–û—Ü–µ–Ω–∫–∞</th>
                    </tr>
                </thead>
                <tbody id="rating-table-body">
                    <!-- –†–µ–π—Ç–∏–Ω–≥ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
                </tbody>
            </table>

            <div class="user-position" id="user-position">
                <!-- –ü–æ–∑–∏—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <footer>
            <p>¬© 2024 –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p>–û—Ç–∫—Ä—ã—Ç–æ –∏–∑ Telegram ‚Ä¢ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <span id="user-id-display">–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</span></p>
        </footer>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUserId = null;
        let isAdminUser = false;
        let ratingVisible = false;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
        async function checkApiStatus() {
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('api-status').innerHTML =
                        `‚úÖ ${data.service} (–≤–µ—Ä—Å–∏—è ${data.version})`;
                    return true;
                }
            } catch (error) {
                console.log('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error);
            }

            document.getElementById('api-status').innerHTML =
                '‚ùå API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
            return false;
        }

        // –ü–æ–ª—É—á–∏—Ç—å User ID –∏–∑ Telegram –∏–ª–∏ URL
        function getUserId() {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Telegram Web App
            if (window.Telegram && Telegram.WebApp) {
                const initData = Telegram.WebApp.initDataUnsafe;
                if (initData && initData.user) {
                    return initData.user.id;
                }
            }

            // –ï—Å–ª–∏ –Ω–µ –≤ Telegram, –ø—Ä–æ–±—É–µ–º –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('user_id');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        function initTelegramWebApp() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();

                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞ –ø–æ–¥ –Ω–∞—à –¥–∏–∑–∞–π–Ω
                Telegram.WebApp.setHeaderColor('#667eea');
                Telegram.WebApp.setBackgroundColor('#764ba2');

                console.log('‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return true;
            }
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞
        async function checkAdminAccess() {
            try {
                const userId = currentUserId;
                if (!userId) {
                    console.log('User ID –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return false;
                }

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
                const response = await fetch(`/api/check_admin?user_id=${userId}`);
                if (response.ok) {
                    const data = await response.json();
                    isAdminUser = data.is_admin || false;
                    return isAdminUser;
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:', error);
            }
            return false;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        async function showAdminPanelUI() {
            const adminBtn = document.getElementById('admin-panel-btn');

            if (isAdminUser) {
                adminBtn.style.display = 'flex';
                console.log('‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
        async function loadRating() {
            try {
                const response = await fetch('/api/rating?type=overall');
                if (response.ok) {
                    const data = await response.json();

                    if (data.rating && data.rating.length > 0) {
                        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                        const tbody = document.getElementById('rating-table-body');
                        tbody.innerHTML = '';

                        const topPlayers = data.rating.slice(0, 20); // –¢–æ–ø-20
                        topPlayers.forEach((player, index) => {
                            const medal = index === 0 ? 'ü•á' :
                                        index === 1 ? 'ü•à' :
                                        index === 2 ? 'ü•â' : `${index + 1}.`;

                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td><span class="medal">${medal}</span></td>
                                <td>${player.username || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</td>
                                <td>${player.score || 0}</td>
                                <td>${player.group_name || '–ë–µ–∑ –≥—Ä—É–ø–ø—ã'}</td>
                                <td>${player.grade ? player.grade.toFixed(2) : '–ù/–î'}</td>
                            `;
                            tbody.appendChild(row);
                        });

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        if (currentUserId) {
                            const userEntry = data.rating.find(u => u.user_id == currentUserId);
                            if (userEntry) {
                                const userPos = document.getElementById('user-position');
                                userPos.innerHTML = `
                                    <strong>–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è:</strong> ${userEntry.rank || '–ù/–î'}<br>
                                    <strong>–í–∞—à–∏ –±–∞–ª–ª—ã:</strong> ${userEntry.score || 0}<br>
                                    <strong>–û—Ü–µ–Ω–∫–∞ –∑–∞ —Å–µ–º–∏–Ω–∞—Ä—ã:</strong> ${userEntry.grade ? userEntry.grade.toFixed(2) : '–ù–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞'}
                                `;
                            } else {
                                const userPos = document.getElementById('user-position');
                                userPos.innerHTML = `
                                    <strong>–í—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ</strong><br>
                                    <em>–ü—Ä–∏–º–∏—Ç–µ —É—á–∞—Å—Ç–∏–µ –≤ —Å–µ–º–∏–Ω–∞—Ä–∞—Ö, —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –≤ —Ä–µ–π—Ç–∏–Ω–≥</em>
                                `;
                            }
                        }
                    } else {
                        document.getElementById('rating-table-body').innerHTML = `
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 30px;">
                                    üì≠ –†–µ–π—Ç–∏–Ω–≥ –ø–æ–∫–∞ –ø—É—Å—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!
                                </td>
                            </tr>
                        `;
                    }
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:', error);
                document.getElementById('rating-table-body').innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: #ff6b6b;">
                            ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
                        </td>
                    </tr>
                `;
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
        function toggleRating() {
            const ratingSection = document.getElementById('rating-section');
            ratingVisible = !ratingVisible;

            if (ratingVisible) {
                ratingSection.style.display = 'block';
                ratingSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                ratingSection.style.display = 'none';
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        function openAdminPanel() {
            const adminSection = document.getElementById('admin-section');
            if (adminSection.style.display === 'none' || adminSection.style.display === '') {
                adminSection.style.display = 'block';
                adminSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                adminSection.style.display = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function openLectures() {
            alert('üìö –õ–µ–∫—Ü–∏–∏\n\n–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ª–µ–∫—Ü–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.\n–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤–∏–¥–µ–æ-–º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –∫—É—Ä—Å—ã.');
        }

        function openSeminars() {
            alert('üéØ –°–µ–º–∏–Ω–∞—Ä—ã\n\n–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–µ–º–∏–Ω–∞—Ä–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.\n–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –∑–∞–¥–∞–Ω–∏—è.');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function openAdminUsers() {
            alert('üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n\n‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π\n‚Ä¢ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø\n‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤');
        }

        function openAdminGroups() {
            alert('üè´ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏\n\n‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø\n‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤\n‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤\n‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤');
        }

        function openAdminRating() {
            alert('üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–º\n\n‚Ä¢ –ü–µ—Ä–µ—Å—á–µ—Ç –æ—Ü–µ–Ω–æ–∫\n‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤\n‚Ä¢ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞\n‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ü–µ–Ω–æ–∫');
        }

        function openAdminContent() {
            alert('üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n\n‚Ä¢ –ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–∫—Ü–∏–π\n‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤\n‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤\n‚Ä¢ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞');
        }


        function openAdminLogs() {
            alert('üìã –õ–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π\n\n‚Ä¢ –õ–æ–≥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–∞–ª–ª–æ–≤\n‚Ä¢ –õ–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π\n‚Ä¢ –õ–æ–≥–∏ —Å–º–µ–Ω—ã –≥—Ä—É–ø–ø\n‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏');
        }

        function openAdminStats() {
            alert('üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã\n\n‚Ä¢ –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º\n‚Ä¢ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\n‚Ä¢ –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å');
        }

        function openAdminSettings() {
            alert('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã\n\n‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞\n‚Ä¢ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–π—Ç–∏–Ω–≥–∞\n‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø\n‚Ä¢ –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã');
        }

        function recalculateAllRatings() {
            if (confirm('üëë –ê–¥–º–∏–Ω-–¥–µ–π—Å—Ç–≤–∏–µ\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –∑–∞ —Å–µ–º–∏–Ω–∞—Ä—ã?\n\n–¢–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç—ã —Å –±–∞–ª–ª–∞–º–∏ > -15 –±—É–¥—É—Ç –≤–∫–ª—é—á–µ–Ω—ã –≤ —Ä–∞—Å—á–µ—Ç.')) {
                alert('üîÑ –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–µ—Ä–µ—Å—á–µ—Ç –æ—Ü–µ–Ω–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.');

                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ API –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞
                setTimeout(async () => {
                    await loadRating();
                    alert('‚úÖ –û—Ü–µ–Ω–∫–∏ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã!');
                }, 1000);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ñ—É—Ç–µ—Ä–µ
        function displayUserInfo() {
            const userInfo = document.getElementById('user-id-display');

            if (currentUserId) {
                userInfo.textContent = currentUserId;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∞–¥–º–∏–Ω–∞
                if (isAdminUser) {
                    userInfo.innerHTML = `${currentUserId} <span style="color: #f1c40f;">üëë –ê–¥–º–∏–Ω</span>`;
                }
            } else {
                userInfo.textContent = '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω';
            }
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        async function init() {
            console.log('–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å');

            // –ü–æ–ª—É—á–∞–µ–º User ID
            currentUserId = getUserId();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            initTelegramWebApp();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            displayUserInfo();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å API
            const apiAvailable = await checkApiStatus();

            // –ï—Å–ª–∏ API –¥–æ—Å—Ç—É–ø–µ–Ω
            if (apiAvailable) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞
                const isAdmin = await checkAdminAccess();

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω
                if (isAdmin) {
                    console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
                    await showAdminPanelUI();
                } else {
                    console.log('‚úÖ –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å');
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥
                await loadRating();
            }

            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å API
            setInterval(checkApiStatus, 30000);

            console.log('‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∂–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', currentUserId);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>